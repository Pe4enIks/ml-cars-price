# ML-сервис предсказания цены автомобиля

https://github.com/Pe4enIks/advanced-ml-task1/assets/57502208/383cb5f3-ef7f-4f8e-89af-f4ca3d577736

## Что было сделано

### EDA
- Удаление дубликатов. Было удалено 1159 строк из 6999.
- Предобработка признаков mileage, engine, max_power, torque. Приведение к float при помощи удаления некоторых вспомогательных единиц измерения, которые находились в признаках, привидение к одинаковым единицам измерения там, где это необходимо.
- Пропуски заполнены медианным значением.
- Преобразование признаков engine и seats к типу int.
- Рассмотрены попарные корреляции и распределения, сравнение распределений на train и test, построили boxplot-ы. Выяснили что распределения на train и test схожи, нашли сильно скоррелированные признаки, обнаружили по распределениям и boxplot-ам выбросы.
- Удаление выбросов по признакам km_driven и max_torque_rpm. Если km_driven >= 500000 или max_torque_rpm >= 5000 - удаляем, как выброс.

### Feature Engineering
- Создан признак power_per_liter равный отношению максимальной мощности к объему двигателя.
- Создан признак mileage_per_liter равный отношению расстояния, которое возможно проехать на одном баке к объему двигателя.
- Создан признак марки автомобиля из признака name.
- Кодирование категориальных признаков при помощи OneHotEncoder. Удаляем первый столбец при кодировании во избежание мультиколлинеарности.

### Обучение модели
- Обучение с различными гиперпараметрами - подбор на основе каких-то знаний, GridSearchCV на 10 фолдах.
- Использовали различные варианты без регуляризации и с регуляризациями L1, L2.

### Измерение метрик
- Использовали метрику R2 для оценки качества на train и test.
- Использовали метрику MSE для оценки качества на train и test.
- Закодирована и измерена бизнес метрика - доля предсказаний, где предсказанная стоимость отличается не более чем на 10% от реальной стоимости по абсолютному значению.

### Лучшая модель
- Метрики R2 для test и train равны соответственно 0.728 и 0.777.
- L2 регуляризация.
- GridSearchCV с 10 фолдами.
- Все предобработки данных описанные в пунках выше.

### Сервис на FastAPI
- Реализовано две ручки API.
- Ручка predict_item предсказывает стоимость одного автомобиля по его признаковому описанию.
- Ручка predict_items предсказывает стоимость для каждого автомобиля из списка по его признаковому описанию.

## Что дало наибольший буст в качестве
- Кодирование категориальных признаков с помощью OneHotEncoder: рост метрики R2 с 0.6 до 0.64.
- Использование признака name - извлечение из него марки автомобиля и кодирование при помощи One-Hot: рост метрики R2 с 0.64 до 0.72.

## Что сделать не вышло и почему
- Распарсить признаки name, torque, engine, mileage, max_power более адекватным способом, чем подгон под шаблон. Думал попробовать использовать регулярные выражения, но данные мне показались слишком разнородными.
